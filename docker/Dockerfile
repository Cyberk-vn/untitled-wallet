FROM public.ecr.aws/r3a1l1p0/chainapsis/ubuntu:20.04firefox-build

RUN mkdir app

COPY ./ /app

WORKDIR /app

ARG TITAN_EXT_ETHEREUM_ENDPOINT
ARG TITAN_EXT_ANALYTICS_API_AUTH_TOKEN
ARG TITAN_EXT_ANALYTICS_API_URL
ARG TITAN_EXT_COINGECKO_ENDPOINT
ARG TITAN_EXT_COINGECKO_GETPRICE
ARG TITAN_EXT_COINGECKO_COIN_DATA_BY_TOKEN_ADDRESS
ARG TITAN_EXT_TRANSAK_API_KEY
ARG TITAN_EXT_MOONPAY_API_KEY
ARG TITAN_EXT_KADO_API_KEY
ARG TITAN_EXT_CHAIN_REGISTRY_URL
ARG TITAN_EXT_GOOGLE_MEASUREMENT_ID
ARG TITAN_EXT_GOOGLE_API_KEY_FOR_MEASUREMENT
ARG TITAN_EXT_TOKEN_FACTORY_BASE_URL
ARG TITAN_EXT_TOKEN_FACTORY_URI
ARG TITAN_EXT_TX_HISTORY_BASE_URL
ARG TITAN_EXT_CONFIG_SERVER
ARG WC_PROJECT_ID
ARG SKIP_API_KEY

ENV TITAN_EXT_ETHEREUM_ENDPOINT $TITAN_EXT_ETHEREUM_ENDPOINT
ENV TITAN_EXT_ANALYTICS_API_AUTH_TOKEN $TITAN_EXT_ANALYTICS_API_AUTH_TOKEN
ENV TITAN_EXT_ANALYTICS_API_URL $TITAN_EXT_ANALYTICS_API_URL
ENV TITAN_EXT_COINGECKO_ENDPOINT $TITAN_EXT_COINGECKO_ENDPOINT
ENV TITAN_EXT_COINGECKO_GETPRICE $TITAN_EXT_COINGECKO_GETPRICE
ENV TITAN_EXT_COINGECKO_COIN_DATA_BY_TOKEN_ADDRESS $TITAN_EXT_COINGECKO_COIN_DATA_BY_TOKEN_ADDRESS
ENV TITAN_EXT_TRANSAK_API_KEY $TITAN_EXT_TRANSAK_API_KEY
ENV TITAN_EXT_MOONPAY_API_KEY $TITAN_EXT_MOONPAY_API_KEY
ENV TITAN_EXT_KADO_API_KEY $TITAN_EXT_KADO_API_KEY
ENV TITAN_EXT_CHAIN_REGISTRY_URL $TITAN_EXT_CHAIN_REGISTRY_URL
ENV TITAN_EXT_GOOGLE_MEASUREMENT_ID $TITAN_EXT_GOOGLE_MEASUREMENT_ID
ENV TITAN_EXT_GOOGLE_API_KEY_FOR_MEASUREMENT $TITAN_EXT_GOOGLE_API_KEY_FOR_MEASUREMENT
ENV TITAN_EXT_TOKEN_FACTORY_BASE_URL $TITAN_EXT_TOKEN_FACTORY_BASE_URL
ENV TITAN_EXT_TOKEN_FACTORY_URI $TITAN_EXT_TOKEN_FACTORY_URI
ENV TITAN_EXT_TX_HISTORY_BASE_URL $TITAN_EXT_TX_HISTORY_BASE_URL
ENV TITAN_EXT_CONFIG_SERVER $TITAN_EXT_CONFIG_SERVER
ENV WC_PROJECT_ID $WC_PROJECT_ID
ENV SKIP_API_KEY $SKIP_API_KEY

RUN yarn install --immutable

RUN yarn build

VOLUME /data

WORKDIR /data

CMD mkdir -p ./build && cd ./build && find . -type f -delete && cp -r /app/apps/extension/build /data
